<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History of Virtual Machines & Containers</title>
    <link rel="stylesheet" href="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1>History of Virtual Machines & Containers</h1>
        <p>From IBM mainframes (1967) to modern microVMs and serverless (2025)</p>
    </div>

    <div class="controls">
        <button class="filter-btn active" data-category="all" onclick="filterCategory('all')">All Events</button>
        <button class="filter-btn" data-category="Mainframe Era" onclick="filterCategory('Mainframe Era')">Mainframe Era</button>
        <button class="filter-btn" data-category="Hardware Support" onclick="filterCategory('Hardware Support')">Hardware Support</button>
        <button class="filter-btn" data-category="Hypervisors" onclick="filterCategory('Hypervisors')">Hypervisors</button>
        <button class="filter-btn" data-category="Containers" onclick="filterCategory('Containers')">Containers</button>
        <button class="filter-btn" data-category="Serverless & Cloud" onclick="filterCategory('Serverless & Cloud')">Serverless & Cloud</button>
        <button class="filter-btn" data-category="Infrastructure Tools" onclick="filterCategory('Infrastructure Tools')">Infrastructure Tools</button>
        <button class="filter-btn" data-category="Research" onclick="filterCategory('Research')">Research</button>
    </div>

    <div class="nav-controls">
        <button class="nav-btn" onclick="panLeft()">&#9664; Pan Left</button>
        <button class="nav-btn" onclick="zoomIn()">+ Zoom In</button>
        <button class="nav-btn" onclick="zoomOut()">- Zoom Out</button>
        <button class="nav-btn" onclick="panRight()">Pan Right &#9654;</button>
        <button class="nav-btn" onclick="fitAll()">Fit All</button>
    </div>

    <div id="timeline"></div>

    <p class="instructions">Click and drag to pan. Click an event to see details below.</p>

    <div class="info-panel">
        <div class="legend">
            <h3>Categories</h3>
            <div class="legend-item">
                <div class="legend-color" style="background: #8b4513;"></div>
                <span>Mainframe Era</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #2980b9;"></div>
                <span>Hardware Support</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #27ae60;"></div>
                <span>Hypervisors</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>Containers</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9b59b6;"></div>
                <span>Serverless & Cloud</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span>Infrastructure Tools</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #1abc9c;"></div>
                <span>Research</span>
            </div>
        </div>

        <div class="event-details">
            <h3>Event Details</h3>
            <div id="details-content">
                <p class="placeholder">Click an event on the timeline to see details here.</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <script>
        // Category colors
        const categoryColors = {
            'Mainframe Era': '#8b4513',
            'Hardware Support': '#2980b9',
            'Hypervisors': '#27ae60',
            'Containers': '#e74c3c',
            'Serverless & Cloud': '#9b59b6',
            'Infrastructure Tools': '#f39c12',
            'Research': '#1abc9c'
        };

        // Store all items for filtering
        let allItems = [];
        let timeline = null;
        let timelineData = null;

        // Load and initialize timeline
        fetch('timeline.json')
            .then(response => response.json())
            .then(data => {
                initializeTimeline(data);
            })
            .catch(error => {
                console.error('Error loading timeline data:', error);
                document.getElementById('timeline').innerHTML =
                    '<p style="text-align:center;color:#e74c3c;padding:40px;">Error loading timeline data.</p>';
            });

        function initializeTimeline(data) {
            // Convert TimelineJS format to vis-timeline format
            allItems = data.events.map((event, index) => {
                const year = parseInt(event.start_date.year);
                const month = parseInt(event.start_date.month || 1) - 1;
                const day = parseInt(event.start_date.day || 1);

                return {
                    id: index + 1,
                    content: event.text.headline,
                    start: new Date(year, month, day),
                    title: event.notes || event.text.text,
                    category: event.group,
                    description: event.text.text,
                    notes: event.notes,
                    displayDate: event.start_date.display_date || `${year}`,
                    style: `background-color: ${categoryColors[event.group]}; color: white; border-color: ${categoryColors[event.group]};`
                };
            });

            // Create DataSet
            timelineData = new vis.DataSet(allItems);

            // Timeline container
            const container = document.getElementById('timeline');

            // Timeline options
            const options = {
                width: '100%',
                height: '400px',
                margin: {
                    item: { horizontal: 50, vertical: 10 },
                    axis: 40
                },
                orientation: 'top',
                zoomMin: 1000 * 60 * 60 * 24 * 365 * 5,    // 5 years minimum zoom
                zoomMax: 1000 * 60 * 60 * 24 * 365 * 80,   // 80 years maximum zoom
                min: new Date(1960, 0, 1),
                max: new Date(2030, 0, 1),
                tooltip: {
                    followMouse: true
                },
                stack: true,
                selectable: true,
                showCurrentTime: false,
                moveable: true,
                zoomable: false,
                align: 'center'
            };

            // Create timeline
            timeline = new vis.Timeline(container, timelineData, options);

            // Set initial window with padding
            setWindowWithPadding(allItems);

            // Event selection handler
            timeline.on('select', function(properties) {
                if (properties.items.length > 0) {
                    showEventDetails(properties.items[0]);
                }
            });
        }

        function setWindowWithPadding(items) {
            if (items.length === 0) return;

            const dates = items.map(item => item.start.getTime());
            const minDate = Math.min(...dates);
            const maxDate = Math.max(...dates);

            // Add 2 years padding on each side
            const twoYears = 2 * 365 * 24 * 60 * 60 * 1000;
            timeline.setWindow(
                new Date(minDate - twoYears),
                new Date(maxDate + twoYears),
                { animation: false }
            );
        }

        function filterCategory(category) {
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });

            if (category === 'all') {
                timelineData.clear();
                timelineData.add(allItems);
                setWindowWithPadding(allItems);
            } else {
                const filtered = allItems.filter(item => item.category === category);
                timelineData.clear();
                timelineData.add(filtered);
                setWindowWithPadding(filtered);
            }

            // Clear event details
            document.getElementById('details-content').innerHTML =
                '<p class="placeholder">Click an event on the timeline to see details here.</p>';
        }

        function showEventDetails(itemId) {
            const item = allItems.find(i => i.id === itemId);
            if (!item) return;

            const detailsHtml = `
                <div class="event-title">${item.content}</div>
                <div class="event-date">${item.displayDate}</div>
                <div class="event-category" style="background-color: ${categoryColors[item.category]}">
                    ${item.category}
                </div>
                <div class="event-description">${item.description}</div>
                ${item.notes ? `
                    <div class="event-context">
                        <strong>Historical Context:</strong> ${item.notes}
                    </div>
                ` : ''}
            `;

            document.getElementById('details-content').innerHTML = detailsHtml;
        }

        // Navigation functions
        function panLeft() {
            const range = timeline.getWindow();
            const interval = (range.end - range.start) * 0.3;
            timeline.setWindow(
                new Date(range.start.getTime() - interval),
                new Date(range.end.getTime() - interval)
            );
        }

        function panRight() {
            const range = timeline.getWindow();
            const interval = (range.end - range.start) * 0.3;
            timeline.setWindow(
                new Date(range.start.getTime() + interval),
                new Date(range.end.getTime() + interval)
            );
        }

        function zoomIn() {
            const range = timeline.getWindow();
            const center = (range.start.getTime() + range.end.getTime()) / 2;
            const newInterval = (range.end - range.start) * 0.5;
            timeline.setWindow(
                new Date(center - newInterval / 2),
                new Date(center + newInterval / 2)
            );
        }

        function zoomOut() {
            const range = timeline.getWindow();
            const center = (range.start.getTime() + range.end.getTime()) / 2;
            const newInterval = (range.end - range.start) * 2;
            timeline.setWindow(
                new Date(center - newInterval / 2),
                new Date(center + newInterval / 2)
            );
        }

        function fitAll() {
            // Get currently visible items
            const currentItems = timelineData.get();
            setWindowWithPadding(currentItems);
        }
    </script>
</body>
</html>
