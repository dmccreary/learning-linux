<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linux Timeline - From Hobby to World Domination</title>

    <!-- vis-timeline CSS (standalone build - the old graph2d build is deprecated) -->
    <link href="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.css" rel="stylesheet">

    <!-- External Stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Linux Timeline - From Hobby to World Domination</h1>
        <p class="subtitle">1991 - 2025: From a student's hobby project to powering the world</p>

        <!-- Category Filter Controls -->
        <div class="filter-controls">
            <span>Filter by:</span>
            <button class="filter-btn all" onclick="filterCategory('all')">All Events</button>
            <button class="filter-btn community" onclick="filterCategory('Community')">Community</button>
            <button class="filter-btn technical" onclick="filterCategory('Technical')">Technical</button>
            <button class="filter-btn commercial" onclick="filterCategory('Commercial')">Commercial</button>
            <button class="filter-btn modern" onclick="filterCategory('Mobile/Modern')">Mobile/Modern</button>
        </div>

        <!-- Navigation Controls -->
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="panLeft()" title="Pan Left">◀</button>
            <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">−</button>
            <button class="zoom-btn fit-btn" onclick="fitAll()" title="Fit All">Fit All</button>
            <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>
            <button class="zoom-btn" onclick="panRight()" title="Pan Right">▶</button>
        </div>

        <!-- Timeline Container -->
        <div id="timeline"></div>

        <!-- Instructions -->
        <p class="instructions">
            Use ◀ ▶ buttons to pan | Use + − buttons to zoom | Click an event for details
        </p>

        <!-- Info Panel -->
        <div class="info-panel">
            <!-- Legend -->
            <div class="legend">
                <h3>Categories</h3>
                <div class="legend-item">
                    <div class="legend-color community"></div>
                    <span class="legend-label">Community Milestones</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color technical"></div>
                    <span class="legend-label">Technical Releases</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color commercial"></div>
                    <span class="legend-label">Commercial Adoption</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color modern"></div>
                    <span class="legend-label">Mobile/Modern Era</span>
                </div>
            </div>

            <!-- Event Details -->
            <div class="event-details">
                <h3>Event Details</h3>
                <div id="eventContent">
                    <p class="placeholder">Click on an event to see details here...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- vis-timeline JavaScript (standalone build - the old graph2d build is deprecated) -->
    <script src="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>

    <script>
        // Category colors
        const categoryColors = {
            'Community': '#27ae60',
            'Technical': '#3498db',
            'Commercial': '#e67e22',
            'Mobile/Modern': '#9b59b6'
        };

        // Store all items for filtering
        let allItems = [];
        let timelineData;
        let timeline;

        // Load timeline data
        fetch('timeline.json')
            .then(response => response.json())
            .then(data => {
                initTimeline(data);
            })
            .catch(error => {
                console.error('Error loading timeline data:', error);
                document.getElementById('timeline').innerHTML =
                    '<p style="padding: 20px; color: red;">Error loading timeline data. Please check the console.</p>';
            });

        function initTimeline(data) {
            // Convert events to vis-timeline format
            allItems = data.events.map((event, index) => {
                const year = parseInt(event.start_date.year);
                const month = parseInt(event.start_date.month || 1) - 1;
                const day = parseInt(event.start_date.day || 1);

                const category = event.group || 'Other';
                const color = categoryColors[category] || '#95a5a6';

                return {
                    id: index,
                    content: event.text.headline,
                    start: new Date(year, month, day),
                    title: `<div style="max-width: 280px; word-wrap: break-word; overflow-wrap: break-word; white-space: normal;">${event.notes || event.text.text}</div>`,
                    style: `background-color: ${color}; border-color: ${color};`,
                    category: category,
                    displayDate: event.start_date.display_date || `${year}`,
                    description: event.text.text,
                    notes: event.notes
                };
            });

            // Calculate min/max dates for initial window
            const dates = allItems.map(item => item.start.getTime());
            const minDate = Math.min(...dates);
            const maxDate = Math.max(...dates);

            // Create dataset
            timelineData = new vis.DataSet(allItems);

            // Timeline options
            // =========================================================================
            // EDGE CLIPPING PREVENTION - JavaScript Configuration
            // =========================================================================
            // Problem: vis-timeline clips event boxes when they extend beyond the
            // visible date range, especially for events near the left/right edges.
            //
            // Solution (Part 1 of 3): Configure margins and alignment options
            // - margin.item.horizontal: Adds 50px buffer around each item
            // - align: 'center': Centers items on their date point so text extends
            //   equally in both directions, reducing edge overflow
            // =========================================================================
            const options = {
                width: '100%',
                height: '400px',
                margin: {
                    item: { horizontal: 50, vertical: 10 },  // Explicit horizontal margin for edge padding
                    axis: 40
                },
                orientation: 'top',
                zoomMin: 1000 * 60 * 60 * 24 * 365 * 5,    // 5 years minimum zoom
                zoomMax: 1000 * 60 * 60 * 24 * 365 * 50,   // 50 years maximum zoom
                min: new Date(1989, 0, 1),   // Allow panning back to 1989
                max: new Date(2027, 0, 1),   // Allow panning to 2027
                tooltip: {
                    followMouse: true
                },
                stack: true,
                selectable: true,
                showCurrentTime: false,
                moveable: true,
                zoomable: false,             // Disable scroll-wheel zoom to not interfere with page scrolling
                align: 'center'              // Center items on their date point
            };

            // Create timeline
            const container = document.getElementById('timeline');
            timeline = new vis.Timeline(container, timelineData, options);

            // Event click handler
            timeline.on('select', function(properties) {
                if (properties.items.length > 0) {
                    showEventDetails(properties.items[0]);
                }
            });

            // =========================================================================
            // EDGE CLIPPING PREVENTION - Window Padding (Part 2 of 3)
            // =========================================================================
            // Problem: Using timeline.fit() sets the window exactly to the data range,
            // causing the first and last events to be positioned at the very edge
            // where their text boxes get clipped.
            //
            // Solution: Manually set the visible window with 2-year padding on each
            // side instead of using fit(). This ensures edge events have room to
            // render their full text boxes without clipping.
            // =========================================================================
            const twoYears = 2 * 365 * 24 * 60 * 60 * 1000;
            timeline.setWindow(
                new Date(minDate - twoYears),
                new Date(maxDate + twoYears),
                { animation: false }
            );
        }

        function addPaddingToView() {
            // Get visible items and manually set window
            const visibleItems = timelineData.get();
            if (visibleItems.length > 0) {
                const dates = visibleItems.map(item => item.start.getTime());
                const minDate = Math.min(...dates);
                const maxDate = Math.max(...dates);

                const twoYears = 2 * 365 * 24 * 60 * 60 * 1000;
                timeline.setWindow(
                    new Date(minDate - twoYears),
                    new Date(maxDate + twoYears),
                    { animation: false }
                );
            }
        }

        function showEventDetails(itemId) {
            const item = allItems.find(i => i.id === itemId);
            if (!item) return;

            const categoryColor = categoryColors[item.category] || '#95a5a6';

            let html = `
                <div class="event-title" style="border-left: 4px solid ${categoryColor}; padding-left: 10px;">
                    ${item.content}
                </div>
                <div class="event-date">${item.displayDate}</div>
                <div class="event-description">${item.description}</div>
            `;

            if (item.notes) {
                html += `<div class="event-context">${item.notes}</div>`;
            }

            document.getElementById('eventContent').innerHTML = html;
        }

        function filterCategory(category) {
            let itemsToShow;
            if (category === 'all') {
                itemsToShow = [...allItems];
            } else {
                itemsToShow = allItems.filter(item => item.category === category);
            }

            timelineData.clear();
            timelineData.add(itemsToShow);

            // =========================================================================
            // EDGE CLIPPING PREVENTION - Filter Window Padding
            // =========================================================================
            // When filtering by category, we must also apply the 2-year padding
            // to prevent edge clipping on the filtered subset of events.
            // =========================================================================
            if (itemsToShow.length > 0) {
                const dates = itemsToShow.map(item => item.start.getTime());
                const minDate = Math.min(...dates);
                const maxDate = Math.max(...dates);

                // Add 2 years padding on each side
                const twoYears = 2 * 365 * 24 * 60 * 60 * 1000;
                const startDate = new Date(minDate - twoYears);
                const endDate = new Date(maxDate + twoYears);

                timeline.setWindow(startDate, endDate, { animation: false });
            }
        }

        function zoomIn() {
            if (timeline) {
                const range = timeline.getWindow();
                const interval = range.end - range.start;
                const newInterval = interval * 0.5; // Zoom in by 50%
                const center = new Date((range.start.getTime() + range.end.getTime()) / 2);
                timeline.setWindow(
                    new Date(center.getTime() - newInterval / 2),
                    new Date(center.getTime() + newInterval / 2)
                );
            }
        }

        function zoomOut() {
            if (timeline) {
                const range = timeline.getWindow();
                const interval = range.end - range.start;
                const newInterval = interval * 2; // Zoom out by 200%
                const center = new Date((range.start.getTime() + range.end.getTime()) / 2);
                timeline.setWindow(
                    new Date(center.getTime() - newInterval / 2),
                    new Date(center.getTime() + newInterval / 2)
                );
            }
        }

        function fitAll() {
            if (timeline) {
                // Get visible items and manually set window with padding
                const visibleItems = timelineData.get();
                if (visibleItems.length > 0) {
                    const dates = visibleItems.map(item => item.start.getTime());
                    const minDate = Math.min(...dates);
                    const maxDate = Math.max(...dates);

                    const twoYears = 2 * 365 * 24 * 60 * 60 * 1000;
                    timeline.setWindow(
                        new Date(minDate - twoYears),
                        new Date(maxDate + twoYears),
                        { animation: false }
                    );
                }
            }
        }

        function panLeft() {
            if (timeline) {
                const range = timeline.getWindow();
                const interval = range.end - range.start;
                const shift = interval * 0.3; // Pan by 30% of visible range
                timeline.setWindow(
                    new Date(range.start.getTime() - shift),
                    new Date(range.end.getTime() - shift)
                );
            }
        }

        function panRight() {
            if (timeline) {
                const range = timeline.getWindow();
                const interval = range.end - range.start;
                const shift = interval * 0.3; // Pan by 30% of visible range
                timeline.setWindow(
                    new Date(range.start.getTime() + shift),
                    new Date(range.end.getTime() + shift)
                );
            }
        }
    </script>
</body>
</html>
